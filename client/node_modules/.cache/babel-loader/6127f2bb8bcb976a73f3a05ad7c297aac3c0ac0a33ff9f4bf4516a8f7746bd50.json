{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createOrJoinSocket = void 0;\nvar globals_1 = require(\"./globals\");\nvar constants_1 = require(\"./constants\");\nvar attach_listener_1 = require(\"./attach-listener\");\nvar attach_shared_listeners_1 = require(\"./attach-shared-listeners\");\nvar manage_subscribers_1 = require(\"./manage-subscribers\");\n//TODO ensure that all onClose callbacks are called\nvar cleanSubscribers = function (url, subscriber, optionsRef, setReadyState, clearSocketIoPingInterval) {\n  return function () {\n    (0, manage_subscribers_1.removeSubscriber)(url, subscriber);\n    if (!(0, manage_subscribers_1.hasSubscribers)(url)) {\n      try {\n        var socketLike = globals_1.sharedWebSockets[url];\n        if (socketLike instanceof WebSocket) {\n          socketLike.onclose = function (event) {\n            if (optionsRef.current.onClose) {\n              optionsRef.current.onClose(event);\n            }\n            setReadyState(constants_1.ReadyState.CLOSED);\n          };\n        }\n        socketLike.close();\n      } catch (e) {}\n      if (clearSocketIoPingInterval) clearSocketIoPingInterval();\n      delete globals_1.sharedWebSockets[url];\n    }\n  };\n};\nvar createOrJoinSocket = function (webSocketRef, url, setReadyState, optionsRef, setLastMessage, startRef, reconnectCount, sendMessage) {\n  if (!constants_1.isEventSourceSupported && optionsRef.current.eventSourceOptions) {\n    if (constants_1.isReactNative) {\n      throw new Error('EventSource is not supported in ReactNative');\n    } else {\n      throw new Error('EventSource is not supported');\n    }\n  }\n  if (optionsRef.current.share) {\n    var clearSocketIoPingInterval = null;\n    if (globals_1.sharedWebSockets[url] === undefined) {\n      globals_1.sharedWebSockets[url] = optionsRef.current.eventSourceOptions ? new EventSource(url, optionsRef.current.eventSourceOptions) : new WebSocket(url, optionsRef.current.protocols);\n      webSocketRef.current = globals_1.sharedWebSockets[url];\n      setReadyState(constants_1.ReadyState.CONNECTING);\n      clearSocketIoPingInterval = (0, attach_shared_listeners_1.attachSharedListeners)(globals_1.sharedWebSockets[url], url, optionsRef, sendMessage);\n    } else {\n      webSocketRef.current = globals_1.sharedWebSockets[url];\n      setReadyState(globals_1.sharedWebSockets[url].readyState);\n    }\n    var subscriber = {\n      setLastMessage: setLastMessage,\n      setReadyState: setReadyState,\n      optionsRef: optionsRef,\n      reconnectCount: reconnectCount,\n      reconnect: startRef\n    };\n    (0, manage_subscribers_1.addSubscriber)(url, subscriber);\n    return cleanSubscribers(url, subscriber, optionsRef, setReadyState, clearSocketIoPingInterval);\n  } else {\n    webSocketRef.current = optionsRef.current.eventSourceOptions ? new EventSource(url, optionsRef.current.eventSourceOptions) : new WebSocket(url, optionsRef.current.protocols);\n    setReadyState(constants_1.ReadyState.CONNECTING);\n    if (!webSocketRef.current) {\n      throw new Error('WebSocket failed to be created');\n    }\n    return (0, attach_listener_1.attachListeners)(webSocketRef.current, {\n      setLastMessage: setLastMessage,\n      setReadyState: setReadyState\n    }, optionsRef, startRef.current, reconnectCount, sendMessage);\n  }\n};\nexports.createOrJoinSocket = createOrJoinSocket;","map":{"version":3,"names":["globals_1","require","constants_1","attach_listener_1","attach_shared_listeners_1","manage_subscribers_1","cleanSubscribers","url","subscriber","optionsRef","setReadyState","clearSocketIoPingInterval","removeSubscriber","hasSubscribers","socketLike","sharedWebSockets","WebSocket","onclose","event","current","onClose","ReadyState","CLOSED","close","e","createOrJoinSocket","webSocketRef","setLastMessage","startRef","reconnectCount","sendMessage","isEventSourceSupported","eventSourceOptions","isReactNative","Error","share","undefined","EventSource","protocols","CONNECTING","attachSharedListeners","readyState","reconnect","addSubscriber","attachListeners","exports"],"sources":["C:\\Users\\Jamari\\Documents\\Hobbies\\Coding\\draftlol\\client\\node_modules\\react-use-websocket\\src\\lib\\create-or-join.ts"],"sourcesContent":["import { MutableRefObject } from 'react';\r\nimport { sharedWebSockets } from './globals';\r\nimport { Options, SendMessage, Subscriber, WebSocketLike } from './types';\r\nimport { isEventSourceSupported, ReadyState, isReactNative } from './constants';\r\nimport { attachListeners } from './attach-listener';\r\nimport { attachSharedListeners } from './attach-shared-listeners';\r\nimport { addSubscriber, removeSubscriber, hasSubscribers } from './manage-subscribers';\r\n\r\n//TODO ensure that all onClose callbacks are called\r\n\r\nconst cleanSubscribers = (\r\n  url: string,\r\n  subscriber: Subscriber,\r\n  optionsRef: MutableRefObject<Options>,\r\n  setReadyState: (readyState: ReadyState) => void,\r\n  clearSocketIoPingInterval: (() => void) | null,\r\n) => {\r\n  return () => {\r\n    removeSubscriber(url, subscriber);\r\n    if (!hasSubscribers(url)) {\r\n      try {\r\n        const socketLike = sharedWebSockets[url];\r\n        if (socketLike instanceof WebSocket) {\r\n          socketLike.onclose = (event: WebSocketEventMap['close']) => {\r\n            if (optionsRef.current.onClose) {\r\n              optionsRef.current.onClose(event);\r\n            }\r\n            setReadyState(ReadyState.CLOSED);\r\n          };\r\n        }\r\n        socketLike.close();\r\n      } catch (e) {\r\n\r\n      }\r\n      if (clearSocketIoPingInterval) clearSocketIoPingInterval();\r\n\r\n      delete sharedWebSockets[url];\r\n    }\r\n  }\r\n};\r\n\r\nexport const createOrJoinSocket = (\r\n  webSocketRef: MutableRefObject<WebSocketLike | null>,\r\n  url: string,\r\n  setReadyState: (readyState: ReadyState) => void,\r\n  optionsRef: MutableRefObject<Options>,\r\n  setLastMessage: (message: WebSocketEventMap['message']) => void,\r\n  startRef: MutableRefObject<() => void>,\r\n  reconnectCount: MutableRefObject<number>,\r\n  sendMessage: SendMessage,\r\n): (() => void) => {\r\n  if (!isEventSourceSupported && optionsRef.current.eventSourceOptions) {\r\n    if (isReactNative) {\r\n      throw new Error('EventSource is not supported in ReactNative');\r\n    } else {\r\n      throw new Error('EventSource is not supported');\r\n    }\r\n  }\r\n\r\n  if (optionsRef.current.share) {\r\n    let clearSocketIoPingInterval: ((() => void) | null) = null;\r\n    if (sharedWebSockets[url] === undefined) {\r\n      sharedWebSockets[url] = optionsRef.current.eventSourceOptions ?\r\n        new EventSource(url, optionsRef.current.eventSourceOptions) :\r\n        new WebSocket(url, optionsRef.current.protocols);\r\n      webSocketRef.current = sharedWebSockets[url];\r\n      setReadyState(ReadyState.CONNECTING);\r\n      clearSocketIoPingInterval = attachSharedListeners(\r\n        sharedWebSockets[url],\r\n        url,\r\n        optionsRef,\r\n        sendMessage,\r\n      );\r\n    } else {\r\n      webSocketRef.current = sharedWebSockets[url];\r\n      setReadyState(sharedWebSockets[url].readyState);\r\n    }\r\n\r\n    const subscriber: Subscriber = {\r\n      setLastMessage,\r\n      setReadyState,\r\n      optionsRef,\r\n      reconnectCount,\r\n      reconnect: startRef,\r\n    };\r\n  \r\n    addSubscriber(url, subscriber);\r\n\r\n    return cleanSubscribers(\r\n      url,\r\n      subscriber,\r\n      optionsRef,\r\n      setReadyState,\r\n      clearSocketIoPingInterval,\r\n    );\r\n  } else {\r\n    webSocketRef.current = optionsRef.current.eventSourceOptions ?\r\n      new EventSource(url, optionsRef.current.eventSourceOptions) :\r\n      new WebSocket(url, optionsRef.current.protocols);\r\n    setReadyState(ReadyState.CONNECTING);\r\n    if (!webSocketRef.current) {\r\n      throw new Error('WebSocket failed to be created');\r\n    }\r\n\r\n    return attachListeners(\r\n      webSocketRef.current,\r\n      {\r\n        setLastMessage,\r\n        setReadyState\r\n      },\r\n      optionsRef,\r\n      startRef.current,\r\n      reconnectCount,\r\n      sendMessage,\r\n    );\r\n  }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}